{"id":34635,"name":"DriveExecution","userId":7514,"accountId":6905,"createdDate":"2020-04-20T10:49:58Z","steps":[{"id":297747,"onSuccess":[],"onFailure":[],"name":"endResult","type":"script","properties":{"body":"done ({\"instancesFound\": config.instanceCounter  });"}},{"id":297737,"onSuccess":["loopInstances"],"onFailure":[],"name":"filesCall","type":"httpRequest","properties":{"headers":"${ steps.getCurrentToken.auth }","method":"GET","url":"https://staging.cloud-elements.com/elements/api-v2/folders/contents?path=%2F"}},{"id":297744,"onSuccess":["positive"],"onFailure":["negative"],"name":"filterByTag","type":"filter","properties":{"body":"var tagArr = steps.shortInstanceArr.instances[steps.loopInstances.index].tags;\n\ntagArr.forEach( function (entry) {\n  console.log(\"Entry: \" + entry);\n  if (entry == \"account_a333\") {\n    done (true);\n  }\n});\n\ndone(false);"}},{"id":297740,"onSuccess":["filterByTag"],"onFailure":[],"name":"getCurrentToken","type":"script","properties":{"body":"var currentInstance = steps.shortInstanceArr.instances[steps.loopInstances.index];\ndone ({\n  \"currentInstance\": currentInstance,\n   \"auth\": {\"Authorization\": \"User <USERTOKEN>, Organization <ORGTOKEN>, Element \" + currentInstance.token}\n});"}},{"id":297730,"onSuccess":["shortInstanceArr"],"onFailure":[],"name":"listInstances","type":"request","properties":{"method":"GET","api":"/instances"}},{"id":297739,"onSuccess":["getCurrentToken"],"onFailure":["endResult"],"name":"loopInstances","type":"loop","properties":{"list":"${ steps.shortInstanceArr.instances }"}},{"id":297746,"onSuccess":["loopInstances"],"onFailure":[],"name":"negative","type":"script","properties":{"body":"done ({ \"instance\": \"Go back to loop and do next\"});"}},{"id":297745,"onSuccess":["filesCall"],"onFailure":[],"name":"positive","type":"script","properties":{"body":"var instance = steps.shortInstanceArr.instances[steps.loopInstances.index];\nconfig.instanceCounter.push(instance);\ndone ({ \"instance\": instance});"}},{"id":297731,"onSuccess":["loopInstances"],"onFailure":[],"name":"shortInstanceArr","type":"script","properties":{"body":"config.instanceCounter = [];\n\nvar body = steps.listInstances.response.body;\n\nvar returnArr = [];\nfor (var i = 0; i < body.length; i++) {\n  var obj = {};\n  obj.token = body[i].token;\n  obj.name = body[i].name;\n  obj.tags = body[i].tags;\n  returnArr.push (obj);\n  console.log (\"Token \" + body[i].token);\n  console.log (\"Name \" + body[i].name);\n}\n\n\n\ndone({\n  \"instances\": returnArr}\n);"}}],"triggers":[{"id":30807,"onSuccess":["listInstances"],"onFailure":[],"type":"manual","async":true,"name":"trigger","properties":{}}],"engine":"v3","active":true,"debugLoggingEnabled":false,"singleThreaded":false,"configuration":[{"id":65050,"key":"instanceCounter","name":"instanceCounter","type":"value","required":true},{"id":65045,"key":"test","name":"test","type":"elementInstance","required":true}]}